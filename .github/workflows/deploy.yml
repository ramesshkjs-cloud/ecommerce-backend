name: Backend Deploy

on:
  workflow_run:
    workflows: ["Backend CI/CD"]
    types:
      - completed
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up JDK 21
      uses: actions/setup-java@v4
      with:
        java-version: '21'
        distribution: 'temurin'
    
    - name: Build for deployment
      run: mvn clean package -DskipTests
    
    - name: Deploy to staging
      run: |
        echo "Deploying to staging environment..."
        ls -la target/
        echo "JAR deployed successfully"
    
    - name: Run smoke tests
      run: |
        echo "Running smoke tests..."
        echo "Smoke tests passed"
    
    - name: Deploy to production
      if: success()
      run: |
        echo "Deploying to production environment..."
        echo "Production deployment completed"